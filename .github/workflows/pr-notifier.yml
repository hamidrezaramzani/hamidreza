name: Notify Discord on PR Activities

on:
  pull_request_review:
    types: [submitted] # Handles "approve" and "request changes"
  pull_request:
    types: [assigned] # Handles "assignee added"

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - name: Check Approved
        if: ${{ github.event.action == 'submitted' && github.event.review.state == 'approved' }}
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          MESSAGE="$(echo -e "$GITHUB_EVENT_PULL_REQUEST_TITLE\n> :bust_in_silhouette: **User**: ${{ github.event.review.user.login }}\n:herb: **Branch**: ${{ github.event.pull_request.head.ref }}\n:deciduous_tree: **Base Branch**: ${{ github.event.pull_request.base.ref }}\n:open_file_folder: **Repository**: ${{ github.repository }}\n:link: **Pull Request Link**: ${{ github.event.pull_request.html_url }}\n:white_check_mark: **Activity**: Approved")"
          curl -X POST -H "Content-Type: application/json" \
            -d "{\"content\": \"${MESSAGE//\"/\\\"}\"}" $DISCORD_WEBHOOK_URL

      - name: Check Request Changes
        if: ${{ github.event.action == 'submitted' && github.event.review.state == 'changes_requested' }}
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          MESSAGE="$(echo -e "$GITHUB_EVENT_PULL_REQUEST_TITLE\n> :bust_in_silhouette: **User**: ${{ github.event.review.user.login }}\n:herb: **Branch**: ${{ github.event.pull_request.head.ref }}\n:deciduous_tree: **Base Branch**: ${{ github.event.pull_request.base.ref }}\n:open_file_folder: **Repository**: ${{ github.repository }}\n:link: **Pull Request Link**: ${{ github.event.pull_request.html_url }}\n:x: **Activity**: Changes Requested")"
          curl -X POST -H "Content-Type: application/json" \
            -d "{\"content\": \"${MESSAGE//\"/\\\"}\"}" $DISCORD_WEBHOOK_URL

      - name: Check Assignee
        if: ${{ github.event.action == 'assigned' }}
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          MESSAGE="$(echo -e "$GITHUB_EVENT_PULL_REQUEST_TITLE\n> :bust_in_silhouette: **User**: ${{ github.event.pull_request.assignee.login }}\n:herb: **Branch**: ${{ github.event.pull_request.head.ref }}\n:deciduous_tree: **Base Branch**: ${{ github.event.pull_request.base.ref }}\n:open_file_folder: **Repository**: ${{ github.repository }}\n:link: **Pull Request Link**: ${{ github.event.pull_request.html_url }}\n:clipboard: **Activity**: Assigned")"
          curl -X POST -H "Content-Type: application/json" \
            -d "{\"content\": \"${MESSAGE//\"/\\\"}\"}" $DISCORD_WEBHOOK_URL
